---
import Layout from '../layouts/Layout.astro';
import { Resend } from 'resend';

// Tato část kódu (frontmatter) se spustí na serveru
// A spustí se POUZE, když je formulář odeslán metodou POST
if (Astro.request.method === 'POST') {
  try {
    // Inicializace Resend s tajným klíčem z prostředí Netlify
    const resend = new Resend(import.meta.env.RESEND_API_KEY);
    
    // Přečtení dat z odeslaného formuláře
    const formData = await Astro.request.formData();
    const name = formData.get('name');
    const email = formData.get('email');
    const message = formData.get('message');

    // Odeslání e-mailu pomocí Resend
    await resend.emails.send({
      from: 'Kontaktni Formular <formular@evermo.cz>', // E-mail, který jste ověřili u Resend
      to: import.meta.env.RECIPIENT_EMAIL, // E-mail příjemce z prostředí Netlify
      subject: `Nová zpráva z webu Laboratoires.cz od ${name}`,
      reply_to: email,
      html: `<p>Jméno: ${name}</p><p>Email: ${email}</p><p>Zpráva: ${message}</p>`,
    });

    // Pokud vše proběhlo v pořádku, přesměrujeme na děkovací stránku
    return Astro.redirect('/dekujeme'); 
    // Nezapomeňte si vytvořit stránku dekujeme.astro!

  } catch (error) {
    // Pokud nastane chyba, vrátíme chybovou odpověď
    console.error(error);
    return new Response("Odeslání selhalo", { status: 500 });
  }
}
---

<Layout title="Kontakt | Laboratoires.cz">
    <section class="py-16 md:py-24 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-serif text-brand-primary mb-2">Kontaktujte nás</h2>
                <p class="text-lg text-gray-600">Máte dotaz? Rádi vám poradíme.</p>
            </div>
            <div class="max-w-4xl mx-auto flex flex-col md:flex-row gap-12">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-serif text-brand-primary mb-4">Spojte se s námi</h3>
                    <div class="space-y-4 text-gray-700">
                        </div>
                </div>
                <div class="md:w-1/2 bg-brand-secondary p-8 rounded-lg shadow-sm">
                    
                    <form action="/kontakt" method="POST">
                        <div class="mb-4">
                            <label for="name" class="block text-brand-text mb-1 font-medium">Jméno</label>
                            <input type="text" id="name" name="name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-brand-accent focus:border-brand-accent" required>
                        </div>
                        <div class="mb-4">
                            <label for="email" class="block text-brand-text mb-1 font-medium">E-mail</label>
                            <input type="email" id="email" name="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-brand-accent focus:border-brand-accent" required>
                        </div>
                        <div class="mb-6">
                            <label for="message" class="block text-brand-text mb-1 font-medium">Vaše zpráva</label>
                            <textarea id="message" name="message" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-brand-accent focus:border-brand-accent" required></textarea>
                        </div>
                        <button type="submit" class="w-full bg-brand-primary hover:bg-brand-text text-white font-bold py-3 px-6 rounded-full transition-colors">Odeslat zprávu</button>
                    </form>
                    <div id="form-feedback" class="mt-4 text-center"></div>
                </div>
            </div>
        </div>
    </section>
</Layout>